---
title: 《IDA Pro权威指南》阅读笔记2

time: 2016.08.17 15:22:00

layout: post
catalog: true
tags:

- 安全工具
- 二进制
- IDA

excerpt: IDA的一些调用约定，函数调用过程和一些快捷键讲解


---

# 《IDA Pro权威指南》阅读笔记2

## 调用约定

1. c调用约定（cdecl） 调用方按从右到左的顺序将函数参数放入栈中，在被调用的函数完成其操作时，调用方（而不是被调用方）负责从栈中清除参数。（可接受数量可变的参数的函数）
2. 标准调用约定：（stdcall） 按从右到左的顺序将函数参数放在程序栈上，函数结束执行时，应由被调用的函数负责删除栈中的函数参数。（这样调用的函数无法接受数量可变的参数，但是这种调用方式在每次调用之后，不需要通过代码从栈中清除参数，速度较快，体积稍小）
3. fastcall约定：其是stdcall的一个变体，它向CPU寄存器（而非程序栈）最多传递两个参数。传递给函数的前两个参数将分别位于ECX和EDX寄存器中。
4. C＋＋约定：Microsoft Visual C++提供thiscall调用约定，它将this传递到ECX寄存器中，并且和在stdcall中一样，它要求非晶态成员函数清除栈中的参数。GNU g＋＋编译器将this看成是任何非静态成员函数的第一个隐含参数，而在所有其他方面与使用cdecl约定相同。因此，其this指针会被放置到栈顶，且调用方负责在函数返回时删除栈中参数。

## 函数调用的过程

1. 调用方将被调用函数所需的任何参数放入到该函数所采用约定指定的位置。如果参数被放到运行时的站上，该操作可能导致程序的栈指针发生改变。
2. 调用方将控制权转交给被调用的函数，这个过程由x86 CALL或MIPS JAL等指令执行。然后，返回地址被保存到程序栈或CPU寄存器中
3. 如有必要，被调用的函数会配置一个栈指针，并保存调用方希望保持不变的任何寄存器值。
4. 被调用的函数为它可能需要的任何局部变量分配空间。一般，通过调整程序栈指针在运行时栈上保留空间来完成这一任务。
5. 被调用的函数执行其操作，可能产生一个结果。在执行操作的过程中，被调用的函数可能会访问调用函数传递给它的参数。如果函数返回一个结果，此结果通常被放置到一个特定的寄存器中，或者放置到函数返回后调用方可立即访问的寄存器中。
6. 函数完成其操作后，任何为局部变量保留的栈空间将被释放。通常，逆向执行第（4）步中的操作，即可完成这个任务。
7. 如果某个寄存器的值还为调用方保存（第（3）步）着，那么将其恢复到原始值。这包括恢复调用方的帧指针寄存器。
8. 被调用的函数将控制权返还给调用方。实现这一操作的主要指令包括x86 RET 和MIPS JR。 根据所使用的调用约定，这一操作可能还会从程序栈中清除一个或多个参数。
9. 调用方一旦重新获得控制权，它可能需要删除程序栈中的参数。这时可能需要对栈进行调整，以将程序栈指针恢复到第1步以前的值。

## 其他

1. 帧指针EBP：程序会使用一个专用的帧指针，所有变量相对于帧指针寄存器的偏移量都可以计算出来。通常，正偏移量用于访问函数参数，而负偏移量则用语访问局部变量。
2. ​

## 快捷键

1. 空格键 在反汇编窗口中用于切换文本视图和图形视图
2. Esc 在反汇编窗口中使用为后退到上个操作的地址处
3. G 键 跳转到指定地址，在反汇编窗口中单击G键会弹出一个输入对话框，在其中可以输入地址或符号，当前光标便会跳转到指定地址处
4. N键 可以对符号进行重命名
5. 冒号键： 和分号键； 在光标所在处添加常规注释和可重复注释。
6. ALT＋M 在当前光标所在地址处添加标签 添加标签有利于，下次寻找该点时，可以直接跳转过来
7. CTRL＋M 列举当前已经添加的标签
8. CTRL＋S 列举出二进制程序的段的开始地址、结束地址、权限等信息
9. 代码数据切换：当IDA自动识别的内容无法满足要求时，用户可以自己控制IDA对文件内容的解析。快捷键C表示将光标所在地址处的内容解析成代码，快捷键D表示解析成数据，快捷键A表示ascii码字符串，快捷键U表示解析成为定义内容
10. X 交叉引用 IDA提供了大量显示和访问交叉引用数据的机制，它以更加直观的方式显示代码和数据之间的关系。
11. 搜索功能 IDA提供了丰富地搜索功能。 Alt＋T快捷键可以在数据库中搜索文本字符串或正则表达式格式的字符串。 Alt + B 快捷键用于十六进制字节序列
12. ​