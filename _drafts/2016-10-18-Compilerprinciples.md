# 编译原理

ε 空，可以做N次幂仍为本身，终结符



在编译原理的上下文无关文法中，终结符可以简单地理解为「推导到这里就终结了」，也就是说不能再继续通过生成式向下推倒的元素就是终结符。一般就是实质上的字符。比如  T->abc。T推导为串abc后已经得到了实质上的字符，不用在向下推导了。
反过来能够继续推导下去的符号就是非终结符。比如上文中的T他代表的是不确定的某种特征的串，可以通过生成式被替换成其他的串。所以叫做非终结符。

## 第一章 总论

1. 编译原理=形式语言+编译技术

2. 编译程序的输入数据是源程序，输出结果是目标程序。

3. 程序设计语言的定义涉及：语法、语义、语用、语境。

4. 汇编程序：把汇编语言程序翻译成等价的机器语言程序（机器指令序列）

5. 编译程序：把高级语言程序翻译成等价的机器语言程序（目标程序）

6. 程序的翻译的两种方式：解释方式和翻译方式

   - 解释执行方式： 解释程序，逐个语句地模拟执行
   - 翻译执行方式： 翻译程序，把程序设计语言程序翻译成等价的目标程序

7. 计算机程序的编译过程，一般分为五个阶段：词法分析、语法分析、语义分析及中间代码生成、代码优化、目标代码生成。

8. 编译程序与具体的机器无关，与具体的语言有关。

   - 词法分析的任务：扫描源程序的字符串，识别出的具有独立意义的最小语法单位（标识符或无正负号数等）
   - 语法分析是：语法分析读入词法分析程序识别出的符号（属性字序列，词），根据给定的语法规则，识别出各个语法结构。在词法分析的基础上的，语法分析不考虑语义。
   - 语义分析的任务是检查程序语义的正确性，解释程序结构的含义，语义分析包括检查变量是否有定义，变量在使用前是否具有值，数值是否溢出等。语法分析完成之后，编译程序通常就依据语言的语义规则，利用语法制导技术把源程序翻译成某种中间代码。所谓中间代码是一种定义明确、便于处理、独立于计算机硬件的记号系统，可以认为是一种抽象机的程序
   - 代码优化的主要任务是对前一阶段产生的中间代码进行等价变换，以便产生速度快、空间小的目标代码
     编译的最后一个阶段是目标代码生成，其主要任务是把中间代码翻译成特定的机器指令或汇编程序

9. 编译划分成前端和后端。

   - 编译前端的工作包括词法分析、语法分析、语义分析。编译前端只依赖于源程序，独立于目标计算机。前端进行分析。
   - 编译后端的工作主要是目标代码的生成和优化后端进行综合。独立于源程序，完全依赖于目标机器和中间代码。

   把编译程序分为前端和后端的优点是：可以优化配置不同的编译程序组合，实现编译重用，保持语言与机器的独立性。

10. 编译程序的分类：

   1. 诊断型编译程序（找错）
   2. 优化型编译程序（产生空间小速度快）
   3. 交叉型编译程序（一些设备上的嵌入式应用软件一般是在另外类型的计算机上设计和开发，经过编译、运行、和测试后再经过一次编译产生出在上述设备上可以运行的目标代码这类编译程序称之为交叉型编译程序）
   4. 可变目标型编译程序Lex是通用的词法分析生成器，它的输入是描述单词结构的正规式，输出的就是词法分析程序。

11. 预处理器：它是在编译程序真正开始翻译源程序之前调用的一个独立的程序，以便加快和简化翻译工作。预处理器可以删除源程序中的注释、空格符等与程序无关的部分，执行宏代换等工作

## 第二章 文法和语言

1. 符号，字母表，符号串，符号串的长度计算 P18，子符号串的含义，符号串的简单运算XY ，Xn，
2. 符号串集合的概念，符号串集合的乘积运算，方幂运算，闭包与正闭包的概念 P19，P20 A0 ={ε}
3. 重写规则，简称规则。非终结符（Vn），终结符（Vt）的概念。
4. 文法的概念。P23 识别符号.P23 文法的第一个重写规则的左部符号为识别符号。BNF表示法 P6
5. 直接推导和直接规约，广义推导广义规约，P24 最左推导，最右推导P62
6. 句型和句子 P26，短语，简单短语，句柄P26，P27
   对于文法G，仅包含终结符的句型称为句子。
   一个句型的最左简单短语称为该句型的句柄。
7. 语言的定义　P31
8. 递归，左递归P32，消除左递归P51
9. 文法的形式化定义　P36　定义
   - 0型文法，短语结构文法
   - 1型文法，上下文有关文法 CSG
   - 2型文法，上下文无关文法 CFG
   - 3型文法，正则文法RG
   - 3型语言类（2型语言类（1型语言类（0型语言类

但四种语言本身之间没有必然的包含关系 P38

- 3型语言的定义 有穷状态自动机 P41
- 2型语言 下推自动机
- 1型语言 线性界限自动机
- 0型语言 图灵机

1. 一个语言的文法是不唯一的。
2. 递归文法的定义。递归文法产生的句型有无限多个
3. 文法的压缩P50，消去规则左递归P51（看例题2.24）
4. 语法分析树的构造，能够根据语法树来寻找短语，直接短语，句柄。(P66习题2的第3条)掌握最左推导和最右推导
5. 文法的二义性问题P60，文法的二义性是不可判定的。
   某文法的同一个句子存在两个不同的语法分析树，则称该文法是有二义性的。

## 第三章 词法分析

1. 词法分析的功能 P69，词法分析的语法基础是正则文法
2. 词法分析器可以有两种实现模式：完全融合模式（大多采用）和相对独立模式，完全独立方式 P71
3. 有穷状态自动机的概念，如何从正则文法构造有穷状态转换自动机 P72(例3.1) P116习题6第1题
4. 如何从有穷状态转换自动机构造正则文法P74
5. 正则文法是无二义性的。能被确定有穷状态自动机识别的语言，一定能用正则表达式表示。
6. 知道确定有穷状态自动机DFA五元组（K，Σ，M，S，F），五个字母的含义。P75
7. 非确定有穷状态自动机NFA，如何将NFA转化为DFA P82 （看懂表3-3）P117习题6第6题，8. DFA的化简，P85（例3.7）习题6第8题
8. NFA和DFA的含义与区别
   NFA不确定的有穷自动机，DFA确定的有穷自动机。NFA即假如一个输入符号，可以得到两个或者两个以上可能的状态，也就是说得到的可能的状态是不确定；DFA即假如一个输入符号，只能得到唯一的一个可能的状态。对于DFA，一个特定的符号输入，有且只能得到一个状态，而NFA就有可能得到一个状态集。
9. 属性字由符号类和符号值组成。特定符号类，一个符号类对应一个符号值：关键字、括号，运算符。非特定符号类：标示符，无符号整数。符号类识别不同类的符号，符号值识别同类的不同符号 P90
10. 字符表，符号机内表示对照表，标示符表，无符号整数表各自的定义和作用P93 词法分析程序的大致思路

## 第四章 语法分析-自顶向下

1. 语法分析的文法基础是上下文无关文法
2. 语法分析的两大类分析方法是自顶向下分析法和自底向上分析法。
3. 带回溯的自顶向下分析方法P121 （一般采用最左或者最右推导）
4. 预测分析技术：消去规则左递归的方法P51；构造first集合和follow集合P138，构造预测分析表P139 输出计算过程本身的方法 P134
5. LL（1）文法的定义 P140
6. 语法分析树建立的方式可以分为自顶向下与自底向上两大类分析技术。
7. 无回溯的自顶向下的预测分析技术需要文法满足两个条件：无回溯和无左递归。P125

### 上下文无关文法

上下文无关文法就是说这个文法中**所有的产生式左边只有一个非终结符**，比如：
S -> aSb
S -> ab
这个文法有两个产生式，每个产生式左边只有一个非终结符S，这就是上下文无关文法，因为你只要找到符合产生式右边的串，就可以把它归约为对应的非终结符。

比如：
aSb -> aaSbb
S -> ab
这就是上下文相关文法，因为它的第一个产生式左边有不止一个符号，所以你在匹配这个产生式中的S的时候必需确保这个S有正确的“上下文”，也就是左边的a和右边的b，所以叫上下文相关文法。作者：徐辰链接：https://www.zhihu.com/question/21833944/answer/40689967来源：知乎著作权归作者所有，转载请联系作者获得授权。



在我看来上下文无关的文法是指，文法中不存在aAc->B aAb ->C这种情况，即在推导过程中A的产生式体选择不受A左右的文法符号串影响（即abc）https://www.zhihu.com/question/21833944



#### 正规式

其上的正规式及其表示的正规集可以[递归](http://baike.baidu.com/view/96473.htm)定义如下。

① ε是一个正规式，它表示集合L(ε)={ε}。

② 若a是∑上的[字符](http://baike.baidu.com/view/263416.htm)，则a是一个正规式，它所表示的正规集L(a)={a}。

③ 若正规式r和s分别表示正规集L(r)、L(s)，则

（a）r|s是正规式，表示集合L(r)∪L(s)；

（b）r·s是正规式，表示集合L(r)L(s)；

（c）r*是正规式，表示集合(L(r))*；

（d）(r)是正规式，表示集合L(r)。

仅由有限次地使用上述三个步骤定义的表达式才是∑上的正规式。

[运算符](http://baike.baidu.com/view/425996.htm)“|”、“·”、“*”分别称为“或”、“连接”和“闭包”。在正规式的书写中，连接运算符“·”可省略。运算符的优先级从高到低顺序排列为：“*”、“·”、“|”。

运算符“|”表示“或”、并集。“*”表示*之前括号里的内容出现0次或多次。

若两个正规式表示的正规集相同，则认为二者等价。两个等价的正规集U和V记作U=V。





### 左递归

一个文法含有下列形式的产生式之一时：

1)A→Aβ，A∈VN，β∈V*

2)A→Bβ，B→Aα，A、B∈VN，α、β∈V*

则称该文法是左递归的。

一个文法G，若存在P经过一次或多次推导得到Pa（即能推导出以P开头的式子）， 则称G是左递归的。

然而，一个文法是左递归时，不能采取自顶向下分析法。

 

左递归分为直接左递归和间接左递归。

直接左递归经过一次推导就可以看出文法存在左递归，如P→Pa｜b。

间接左递归侧需多次推导才可以看出文法存在左递归，如文法：S→Qc｜c，Q→Rb｜b，R→Sa｜a有S =>Qc =>Rbc =>Sabc

 

**消除左递归方法有：**

a)**把直接左递归改写为右递归：**

设有文法产生式：A→Aβ|γ。其中β非空，γ不以A打头。

可写为：A→γA'

A'→βA'|ε

一般情况下，假定关于A的产生式是：

A→Aα1| Aα2 |… |Aαm|β1|β2 |…|βn

其中，αi(1≤i≤m)均不为空，βj(1≤j≤n)均不以A打头。

则消除直接左递归后改写为：

A→ β1A'| β2 A' |…| βnA'

A'→ α1A' | α2A' |…| αmA' |ε

 

例：有文法G(E)：

E→E +T |T

T→T*F | F

F→ (E)|i

消除该文法的直接左递归。

解：按转换规则,可得:

E→TE'

E'→+TE'|ε

T→FT '

T'→*FT'|ε

F→(E)|i

b)**消除间接左递归：**

对于间接左递归的消除需要先将间接左递归变为直接左递归，然后再按a)清除左递归。

例：以文法G6为例消除左递归：

(1)A→aB

(2)A→Bb

(3)B→Ac

(4)B→d

解：用产生式(1)，(2)的右部代替产生式(3)中的非终结A得到左部为B的产生式：

(1)B→aBc

(2)B→Bbc

(3)B→d

消除左递归后得到：

B→aBcB' |dB'

B'→bcB' |ε

再把原来其余的产生式A→aB,A→Bb加入，最终得到等价文法为:

(1) A→aB

(2) A→Bb

(3) B→(aBc|d)B'

(4) B'→bcB'|ε

 

c)**消除文法中一切左递归的算法**

要求文法不存在A 经过一次或多次能推导出A和不存在ε产生式（形如Ａ→ε）。 

　　1、以某种顺序排列非终结符A1，A2，……，An；

　　2、for i ＝ 1 to n do

　　　　{for j ＝ 1 to i - l do

　　　　　{ 用产生式Ａi→a1b｜a2b｜……｜akb代替每个开如Ai→Ajb的产生式，其中，Aj→a1｜a2｜……｜ak是所有的当前Aj产生式；}

　　　　消除关于Ai产生式中的直接左递归性}

　　　}

　　3、化简由步骤2所得到的文法。

 

　　例2：有文法S→Qc｜c，

Q→Rb｜b，

R→Sa｜a，

消除文法的左递归。

　　以非终结符号排序为R，Q，S

　　把R的产生式代入Q中有：

　　Q → （Sa｜a）b｜b

　　Q → Sa b｜ab｜b

　　把Q的产生式代入S中有：

　　S → （Sa b｜ab｜b）c｜c 　 

　　S → Sa bc｜abc｜bc｜c

　　消除直接左递归得到结果：

　　S → abcS’｜bc S’｜cS’ 

　　S’→ abcS’｜ε

　　Q → Sa b｜ab｜b 

　　R → Sa｜a 

　　Q 和 R的产生式是多余的删除，得到最终结果：

　　S → abcS’｜bc S’｜cS’ 

        S’→ abcS’｜ε

注意，由于对非终结符排序的不同，最后所得的文法在形式上可能不一样。但不难证明，它们都是等价的。

例如对上述文法的非终结符排序选为S,Q,R，那么，所得的无左递归文法是：

把Q的产生式代入S中有：

S->Qc|c

S->(Rb|b)c|c

S->Rbc|bc|c

把S的产生式代入R中有：

R->Sa|a

R->(Rbc|bc|c)a|a

R->Rbca|bca|ca|a

 消除直接左递归得到结果：

R->bcaR'|caR'|aR'

R'->bcaR'|ε

与上面文法是等价的。

## 第五章 语法分析-自底向上

1. 规范分析：最右推导被称为规范推导，最左规约被称为规范规约。 P145
2. 自底向上语法分析方法的基本思想是，利用文法的规则逐步向上进行规约，直到文法的识别符号。
3. 分析所需要解决的两个基本问题：找出要被归约的短语u；确定归约到哪个非终结符号U
4. 一个符号串的前缀是指该串的任一部分。一个规范句型的前缀若不含句柄之后的任何符号就称为活前缀
5. 基本方法：移入规约法 P147 四个动作之一：移进归约接受出错
6. 算符优先分析技术： P150 定义5.2 构造算符优先关系表 P151-154 算符优先识别算法P１５５重点掌握FIRSTTERM集合和LASTTERM集合的计算方法
7. ?
8. LR(k)分析技术 ,要知道其中定义:
   圆点在产生式最右端的项目称为可归约项，如E→E+T· ；圆点后面是终结符的项目称为移进项 ，如E→E·+T ； 圆点后面是非终结符的项目称为待约项 ， 如E→E+·T。
   项，项集，项集的闭包
   特征有穷状态机 CFSM. P183。 CFSM表中无不适定状态的称为LR(0) 文法
   SLR（1）文法：各个简单向前看k集合互不相交 P191
   LALR文法：构造LR（1）项，然后合并同心项，生成LALR 规约冲突 P199
   LR（k）文法。

## 第六章 语义分析与生成目标代码

1. 语义分析的基本功能：确定类型；类型检查；识别含义，作相应的语意处理；其他一些静态语义检查。 P215
2. 语义分析以语法分析部分的输出（语法分析树或其他等价内部中间表示）为输入，输出中间表示代码，甚至目标代码。 P215
3. 语义是上下文相关的
4. 语法制导翻译技术
5. 中间代码生成依据语言的语义规则
6. 抽象语法树的画法 P297
7. 逆波兰式的生成 P300
8. 四元式的生成 P306
9. 三元式

## 第七章 运行环境

1. 代码优化的定义 P348 ：是在编译时刻为改进目标程序的质量而进行的各项工作。改进质量以提升时间效率和空间效率两方面。
2. 注意点：代码优化进行的是等价变换，为优化进行努力应当是值得的。
3. 基本块的概念， 对基本块的优化：合并常量计算，消除公共子表达式，消减计算强度，删除无用代码。对循环的优化：循环不变表达式外提，归纳变量删除，计算强度消减。
4. 代码优化的三个过程：控制流分析，数据流分析，变化。 P350 各自的含义
5. 代码优化是基于中间表示代码进行的
6. 窥孔优化： 定义 P395 包括：四种典型优化，各自的含义、