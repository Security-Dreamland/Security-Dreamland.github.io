# 渗透测试

## 0x00 收集信息

1. 端口扫描

   - 端口扫描用以收集服务器运行了哪些服务

     >一是要关注扫描到的开放服务，比如redis，rsync，这时候就要考虑对应服务的攻击，比如未授权访问。二是关注filtered的服务，这往往代表服务器运行着这类服务，但是iptables限制了其访问。@firesun

     ​

     ​

Cobalt Strike

2. Web目录扫描

   - 获取一些敏感信息：后台地址、phpadmin、vim备份

3. 其它搜集

   - 子域名搜集：[subDomainsBrute](https://github.com/lijiejie/subDomainsBrute)

   - 网站环境搜集：脚本语言（PHP、JSP、.NET)、Web容器（Apache、IIS、Nginx）、系统（Linux、Windows）、数据库（Mysql、MSSQL、access、Oracle)、前端框架（JQuery、Bootstrap、HTML5）、Web应用（BBS、CMS、BLOG）、Web开发框架（Django、Rails、ThinkPHP）

   - 是否静态：初看静态，则查明是否伪静态。

     > Chrome先打开网页，然后在「视图」—「开发者」—「Javascript 控制台」，回车。
     > （快捷键是：option+command+j ）
     >
     > Console:document.lastModified
     >
     > 若为最新事件，则为伪静态。

   - 邮箱地址

   - Google搜索(搜索引擎搜索)

     ```
     搜集敏感文件：site:xxx.com filetype:doc
     搜集管理后台：site:xxx.com 管理／site:xxx.com admin／site:xxx.com login
     site:xxx  inurl:admin | login | manage | sign | administrator
     搜集mail：site:xxx.com intext:@xxx.com／intext:@xxx.com
     搜集敏感web路径：site:xxx.com intitle:登录／site:xxx.com inurl:sql.php
     owa和vpn入口
     		intitle:"Dell Remote Access Controller"
     	
     ```

   - Github搜索:https://github.com/repoog/GitPrey

   - 版本控制软件泄漏：Git、SVN、CVS

   - Robots.txt

   - 威胁情报：[Nosec](https://nosec.org/)和[threatbook](https://threatbook.cn/)

   - 扫描工具：

     - AVWS

     - bugscann：[bugscan](http://www.bugscan.net)

     - CMS识别：[bugscanner](http://whatweb.bugscaner.com/)

     - 字典库：[fuzzdb扩展库](https://github.com/tennc/fuzzdb)

     - Flash XSS 扫描：[FlashScanner](https://github.com/riusksk/FlashScanner)

     - Webshell扫描：[ScanBackdoor](https://github.com/ym2011/ScanBackdoor)、[ScanWebShell.pl](https://github.com/yuchen/clarkyu/blob/548dfc56c48cea4be5ac1621cec6e2720a815563/_personal/tools/EditPlus/Commands/Perl/ScanWebShell.pl)

     - struts扫描：[StrutScan](https://github.com/riusksk/StrutScan)

     - 端口扫描：Nmap、[HighRiskPort](https://github.com/ct0p5/HighRiskPort)

     - DNS域传送:dig example.com找到对应DNS解析服务器,再通过dig axfr @dns.example.com example.com检查是否存在DNS域传送问题。

     - LFI自动探测panoptic：https://github.com/lightos/Panoptic

     - load_file自动探测sqlnuke：https://github.com/nuke99/sqlnuke.git mysqlload_file

     - wordpress的站用wpscan扫描

       ​

       ​

     > ```
     > web类(web漏洞/敏感目录)： 
     > 第三方通用组件漏洞struts thinkphp jboss ganglia zabbix cacti
     > 80 
     > 80-89 
     > 8000-9090 
     > 特殊服务类(未授权/命令执行类/漏洞)：
     > 1099 rmi命令执行
     > 8000 jdwp java调试接口命令执行 
     > 443 SSL心脏滴血 
     > 873 Rsync未授权 
     > 5984 CouchDB http://xxx:5984/_utils/ 
     > 6379 redis未授权 
     > 7001,7002 WebLogic默认弱口令，反序列 
     > 9200,9300 elasticsearch
     > 11211 memcache未授权访问 
     > 27017,27018 Mongodb未授权访问 
     > 50000 SAP命令执行 
     > 50060,50070,50030 hadoop默认端口未授权访问 
     > 2375,docker未授权访问
     > 3128 squid代理默认端口
     > 2601,2604 zebra路由，默认密码zebra
     > 4440 rundeck
     > 4848 glassfish 中间件弱口令 admin/adminadmin
     > 9000 fcigphp代码执行
     > 9043 websphere 弱口令admin/admin
     > 常用端口类(扫描弱口令/端口爆破)： 
     > 21 ftp 
     > 22 SSH 
     > 23 Telnet  
     > 161 SNMP 
     > 389 LDAP  
     > 445 SMB 
     > 1433 MSSQL 
     > 1521 Oracle 
     > 3306 MySQL 
     > 3389 远程桌面 
     > 5432 PostgreSQL 
     > 5900 vnc
     > ```





http://shetuan.student.tsinghua.edu.cn/b/xj/zpb/upload

## 0x01 渗透测试

### PHP

#### JSP



## 0x02 常见漏洞

## 越权类

乌云drops - 小川 我的越权之道
<http://static.hx99.net/static/drops/tips-727.html>

**常见越权点**
查看我的订单 已完成/未完成/已取消
前往支付的页面
下载账单/打印账单
个人中心
提交订单
订单确认
编辑已有地址
添加新地址

## 枚举类/爆破类

无验证码/验证码过于简单/验证码未刷新

如找回密码处可枚举潜在的帐号

边缘登录机制访问频率未设防,比如,
1,公众号绑定帐号时接口未做访问限制
2,App接口
3,分站登录处 (这样看单点登录SSO是个好主意?)
4,老旧登录接口 webqq什么的

短信验证码接口 轰炸

验证码回传 双开

## 逻辑漏洞

### 登录类

绕过登录
各种抓包改包

### 密码重置

drops 密码找回逻辑漏洞总结
<http://static.hx99.net/static/drops/web-5048.html>

密码重置
密码找回
任意用户注册
修改手机号/Email

### 支付类

在线支付逻辑漏洞总结
<http://static.hx99.net/static/drops/papers-345.html>

总价改负数或0.01
单个商品改负数价格导致总价降低

### 步骤类

各种强行跳过步骤

## 跳转类

```
@符号
www.ly.com@baidu.com
```

## XSS

说到xss一定要提 gainover (pkav) 和 heige (知道创宇).

平台
xssnow
<http://xssnow.com/>
xsstv
[http://xss.tv](http://xss.tv/)

安全文库 微信公众号
XSS挑战之旅（前五关）讲解
XSS挑战之旅（其余关卡讲解）

xss常见payload
反射型一般主站收

**常见位置**
多注意交互点
提交表单带HTML处
提交客服/留言反馈 (盲打后台)
个人信息/个人资料 (一般很多人都会测这里)
搜索栏 (反射型)
见框就插(解决部分过滤的办法?)
头像处xss

## CSRF

只要没有唯一标识、用户输入的参数可控不唯一，
没有csrftoken或者csrftoken无作用

**潜在位置**
订阅处
评论处
添加用户
密码修改
资料修改
删除
订单操作

## 上传漏洞

文件后缀 白名单与黑名单问题
黑名单容易被绕过
前端限制(抓包修改绕过)
扩展名检查(nginx解析漏洞)
content-type (burp突破)
文件头 (图片木马)
其他(waf缺陷)

## 命令执行

黑盒测试难度较大

要求参数可控并在处理过程中有玩儿提
比如 python 的 os.system
或 php 的 eval()

做fuzzing

## SQL 注入

考虑到 WAF 逐渐成熟，就算有也很难利用
需要过WAF的payload

如何判断数据库类型
fuzzing payload/tamper script

sqlmap os-shell 编码问题





